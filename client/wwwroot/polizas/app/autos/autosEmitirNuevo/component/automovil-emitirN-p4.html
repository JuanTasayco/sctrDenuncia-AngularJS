<!-- Step 4 -->
<form action="" name="frmEmitN4">

  <div class="g-section-inner">
    <div class="container">

      <div class="row">
        <div class="col-md-12">
          <h2 class="g-sub-title">Datos del Gestor de Cobro <span ng-hide="formData.IS_REQUIRED_RC">(opcional)</span></h2>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4">
          <div class="row">
            <div class="col-md-6 mb-xs-2">
              <m-radio
                label="{label: 'Registro de cuenta'}"
                name="nRegistro"
                ng-model="formData.registro"
                value="DB"
                ng-click="clearCollectionManager(formData.registro, true)">
              </m-radio>
            </div>
            <div class="col-md-6 mb-xs-2">
              <m-radio
                label="{label: 'Registro de tarjeta'}"
                name="nRegistro"
                ng-model="formData.registro"
                value="TA"
                ng-click="clearCollectionManager(formData.registro, true)">
              </m-radio>
            </div>
          </div>
        </div>
      </div>
      <div class="row" ng-if="isRegistroCuenta()">
        <div class="col-md-4 mb-xs-2">
          <mpf-select
            label="{label: 'Entidad', required: formData.IS_REQUIRED_RC}"
            name="nEntidad"
            ng-model="formData.entidad"
            text-field="Descripcion"
            value-field="Codigo"
            m-data-source="entidades"
            m-Empty-Option="{enterData:true}"
            ng-change="onEntidadChange(formData.entidad)"
            ng-required="formData.IS_REQUIRED_RC">
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nEntidad.$error.required && !frmEmitN4.nEntidad.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4 mb-xs-2">
          <mpf-input
            label="{label: 'Oficina', required: formData.IS_REQUIRED_RC}"
            name="nOficina"
            ng-model="formData.oficina"
            ng-required="formData.IS_REQUIRED_RC"
            ng-disabled="true">
          </mpf-input>
          <ul class="g-error">
            <li ng-show="!frmEmitN4.nOficina.$valid && !frmEmitN4.nOficina.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4 mb-xs-2">
          <mpf-select
            label="{label: 'Tipo de cuenta', required: formData.IS_REQUIRED_RC}"
            name="nTipoCuenta"
            ng-model="formData.tipoCuenta"
            text-field="Descripcion"
            value-field="Codigo"
            m-data-source="tipoCuentas"
            m-Empty-Option="{enterData:true}"
            ng-required="formData.IS_REQUIRED_RC">
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nTipoCuenta.$error.required && !frmEmitN4.nTipoCuenta.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
      </div>
      <div class="row" ng-if="isRegistroCuenta()">
        <div class="col-md-4 mb-xs-2">
          <mpf-select
            label="{label: 'Moneda', required: formData.IS_REQUIRED_RC}"
            name="nMoneda"
            ng-model="formData.moneda"
            text-field="Descripcion"
            value-field="Codigo"
            m-data-source="monedas"
            m-Empty-Option="{enterData:true}"
            ng-required="formData.IS_REQUIRED_RC">
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nMoneda.$error.required && !frmEmitN4.nMoneda.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4 mb-xs-2">
          <mpf-input
            label="{label: 'Cta calcular', required: formData.IS_REQUIRED_RC}"
            name="nCalcular"
            ng-model="formData.ctaCalcular"
            ng-maxlength="formData.maxCuenta"
            mpf-validation="onlyNumber"
            ng-required="formData.IS_REQUIRED_RC"
            ng-blur="onCtaCalcular(formData.ctaCalcular)">
          </mpf-input>
          <ul class="g-error">
            <li ng-show="!frmEmitN4.nCalcular.$valid && !frmEmitN4.nCalcular.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4 mb-xs-2">
          <mpf-input
            label="{label: 'Cuenta', required: formData.IS_REQUIRED_RC}"
            name="nCuenta"
            ng-model="formData.cuenta"
            mpf-validation="onlyLetterNumber"
            ng-maxlength="100"
            ng-required="formData.IS_REQUIRED_RC"
            ng-disabled="true">
          </mpf-input>
          <ul class="g-error">
            <li ng-show="!frmEmitN4.nCuenta.$valid && !frmEmitN4.nCuenta.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
      </div>
      <div class="row" ng-if="isRegistroCuenta()">
        <div class="col-md-4">
          <mpf-select
            label="{label: 'Código gestor', required: formData.IS_REQUIRED_RC}"
            name="nCodigoGestorEn"
            ng-model="formData.codigoGestorEn"
            m-data-source="formData.codigoGestoresEn"
            text-field="Descripcion"
            value-field="Codigo"
            m-Empty-Option="{enterData:true}"
            ng-required="formData.IS_REQUIRED_RC" >
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nCodigoGestorEn.$error.required && !frmEmitN4.nCodigoGestorEn.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
      </div>
      <div class="row" ng-if="isRegistroTarjeta()">
        <div class="col-md-4 mb-xs-2">
          <mpf-select
            label="{label: 'Tipo de tarjeta', required: formData.IS_REQUIRED_RT}"
            name="nTipoTarjeta"
            ng-model="formData.tipoTarjeta"
            text-field="Descripcion"
            value-field="Codigo"
            m-data-source="tipoTarjetas"
            ng-change="onTipoTarjetaChange(formData.tipoTarjeta)"
            m-Empty-Option="{enterData:true}"
            ng-required="formData.IS_REQUIRED_RT">
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nTipoTarjeta.$error.required && !frmEmitN4.nTipoTarjeta.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4 mb-xs-2">
          <mpf-select
            label="{label: 'Código tarjeta', required: formData.IS_REQUIRED_RT}"
            name="nCodigoTarjeta"
            ng-model="formData.codigoTarjeta"
            text-field="Descripcion"
            value-field="Codigo"
            m-data-source="formData.codigoTarjetas"
            m-Empty-Option="{enterData:true}"
            ng-required="formData.IS_REQUIRED_RT">
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nCodigoTarjeta.$error.required && !frmEmitN4.nCodigoTarjeta.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4 mb-xs-2">
          <mpf-input
            label="{label: 'N. Tarjeta', required: formData.IS_REQUIRED_RT}"
            name="nTarjeta"
            ng-model="formData.numeroTarjeta"
            ng-maxlength="formData.maxTarjeta"
            ng-required="formData.IS_REQUIRED_RT"
            ng-change="onNumeroChange()"
            ng-blur="onNumeroBlur()">
          </mpf-input>
          <ul class="g-error">
            <li ng-show="!frmEmitN4.nTarjeta.$valid && !frmEmitN4.nTarjeta.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
      </div>
      <div class="row" ng-if="isRegistroTarjeta()">
        <!-- Deberia ser un datepicker -->
        <div class="col-md-4 mb-xs-2 no-mb-md">
          <mpf-input
            label="{label: 'Fecha de vencimiento de tarjeta (mm/yyyy)', required: formData.IS_REQUIRED_RT}"
            name="nFecha"
            ng-model="formData.fechaTarjeta"
            ng-maxlength="7"
            ng-pattern="pattern"
            ignore-trunc="true"
            ng-required="formData.IS_REQUIRED_RT">
          </mpf-input>
          <ul class="g-error">
            <li ng-show="!frmEmitN4.nFecha.$valid && !frmEmitN4.nFecha.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
        <div class="col-md-4">
          <mpf-select
            label="{label: 'Código gestor', required: formData.IS_REQUIRED_RT}"
            name="nCodigoGestorTa"
            ng-model="formData.codigoGestorTa"
            text-field="Descripcion"
            value-field="Codigo"
            m-data-source="formData.codigoGestoresTa"
            m-Empty-Option="{enterData:true}"
            ng-required="formData.IS_REQUIRED_RT">
          </mpf-select>
          <ul class="g-error">
            <li ng-show="frmEmitN4.nCodigoGestorTa.$error.required && !frmEmitN4.nCodigoGestorTa.$pristine">* Este campo es requerido</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div class="g-section-inner">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <h2 class="g-sub-title">Archivo cargomático <span ng-hide="isRequiredFile()">(opcional)</span></h2>
        </div>
      </div>
      <div class="row">
        <div class="col-md-4 col-sm-6 g-text-center-xs">

          <div class="clearfix g-box fz14 gBgcGray5 pt-xs-2 pb-xs-2" ng-if="formData.selectLoadFile">
            <div class="col-md-12 mb-xs-1">
              <span>Cargar documento escaneado</span>
            </div>
            <div class="col-md-10 col-md-offset-1">
              <label class="g-btn g-btn-white second-design block g-btn-input-file">
                <span class="g-icon">
                  <span class="icon icon-plus ico-mapfre_56_visitasalmedico"></span>
                  <span>Escoger archivo</span>
                </span>
                <input type="file" data-show-preview="false" id="iLoadFile" name="nLoadFile" file-model="formData.fmLoadFile" ng-model="formData.mLoadFile" ng-required="isRequiredFile()" onchange="angular.element(this).scope().fnChangeLoadFile()">
              </label>
              <ul class="g-error">
                <li ng-show="!frmEmitN4.nLoadFile.$valid && !frmEmitN4.nLoadFile.$pristine">* Seleccione un archivo</li>
                <!-- ".JPEG", ".MSG", ".WAVE", ".PDF", ".MSW12" -->
              </ul>
            </div>
          </div>

          <div class="clearfix g-box fz14 gBgcGray5 pt-xs-2 pb-xs-2" ng-if="!formData.selectLoadFile">
            <div class="col-md-12 mb-xs-0-5">
              <span class="ico-mapfre_314_archivos gnIcon-lg gCGray3"></span>
            </div>
            <div class="col-md-12">
              <b>{{formData.nameLoadFile}}</b>
            </div>
            <div class="col-md-12 mb-xs-1">
              Documento cargado exitosamente
            </div>
            <div class="col-sm-12">
              <label class="g-btn-input-file">
                <span class="g-icon gCGreen1">
                  <span class="icon ico-mapfre_311_arrowRight"></span>
                  <span class="g-link no-uppercase"><b>Volver a cargar documento</b></span>
                </span>
                <input type="file" data-show-preview="false" id="iLoadFile" name="nLoadFile" file-model="formData.fmLoadFile" ng-model="formData.mLoadFile" ng-required="false" onchange="angular.element(this).scope().fnChangeLoadFile()">
              </label>
            </div>
          </div>

        </div>

      </div>
    </div>
  </div>

  <div class="g-section">
    <div class="container">
      <div class="row">
        <div class="col-md-4 col-md-offset-4">
          <a class="g-btn g-btn-verde block"
          ga-click ga-category="'Emisa - Auto'" ga-action="'MPF - Emisión'" ga-label="'Botón: Emitir'" ga-value="'Nuevo'"
          ng-click="emit()">Emitir Poliza</a>
        </div>
      </div>
    </div>
  </div>
</form>
