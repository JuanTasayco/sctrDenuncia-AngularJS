<section class="g-page page-segurviaje-cotizar">
  <div class="container">
    <div class="row">
      <div class="col-sm-9">
        <page-title info="{title: 'Documentos Viajes'}"></page-title>
      </div>
      <div class="col-sm-3">
        <button type="submit" ng-click="vm.exportEmisions()" class="g-btn g-btn-verde second-design block mt-xs-2">
          Exportar
        </button>
      </div>
    </div>
  </div>

  <!-- Inicio: Col Filter -->
  <div class="g-section-inner">
    <div class="container">
      <div class="row">
        <!-- Inicio: Filter -->
        <div class="col-md-3 mb-xs-2">
          <div show-filter class="clearfix g-col-filter g-box-md gBgcGray5-md gBgcWhite1">
            <div class="col-md-12">
              <form ng-submit="vm.getEmission()" name="filterForm">
                <div class="clearfix gH4 gCGray1 mb-xs-1-5">
                  <h2 class="hidden-xs hidden-sm pb-xs-1 g-border-bottom-xs"><b>BÚSQUEDA</b></h2>
                  <div id="show-filter" class="row pt-xs-1 pb-xs-1 gBgcGray5 g-border-bottom-xs hidden-md hidden-lg" ng-click="toggleFilter();">
                    <div class="col-xs-10"><h2><b>BÚSQUEDA</b></h2></div>
                    <div class="clearfix"></div>
                  </div>
                </div>
                <div class="g-border-bottom-xs pb-xs-2 mb-xs-2">
                  <div class="row">
                    <div class="col-md-12 pt-xs-1 pb-xs-1">
                      <m-radio
                        label="{label: 'Por contratante/asegurado'}"
                        name="typeSearch"
                        ng-model="vm.filter.typeSearch"
                        value="1"
                        data-ng-required="true">
                      </m-radio>
                      <div ng-show="vm.filter.typeSearch == 1 ">
                        <mpf-input
                          class="mb-xs-1"
                          label="{label: 'NOMBRE / RAZON SOCIAL', required: false}"
                          name="nombre"
                          ng-model="vm.filter.contractor">
                        </mpf-input>
                        <mpf-select
                          class="mb-xs-1"
                          ng-model="vm.filter.documentType"
                          name="tipo"
                          label="{label: 'TIPO DE DOCUMENTO', required: true}"
                          m-data-source="vm.tipoDocumentos"
                          text-field="description"
                          value-field="description"
                          m-empty-option="{enterData:true, text: 'TODOS'}">
                        </mpf-select>
                        <mpf-input
                          class="mb-xs-1"
                          label="{label: 'NUM. DOCUMENTO', required: false}"
                          name="numDocumento"
                          mpf-validation="onlyNumber"
                          ng-model="vm.filter.documentNumber">
                        </mpf-input>
                      </div>
                    </div>
                    <div class="col-md-12 pt-xs-1 pb-xs-1">
                      <m-radio
                        label="{label: 'Num. de póliza'}"
                        name="typeSearch"
                        ng-model="vm.filter.typeSearch"
                        value="2"
                        data-ng-required="true">
                      </m-radio>
                      <div ng-show="vm.filter.typeSearch == 2 ">
                        <div class="pt-md-1">
                          <mpf-input
                            label="{label: 'Num. de Poliza', required: false}"
                            name="numpoliza"
                            mpf-validation="onlyNumber"
                            ng-model="vm.filter.policyNumber">
                          </mpf-input>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-12 pt-xs-1 pb-xs-1">
                      <m-radio
                        label="{label: 'Fecha de emisión'}"
                        name="typeSearch"
                        ng-model="vm.filter.typeSearch"
                        value="3"
                        data-ng-required="true">
                      </m-radio>
                      <div ng-show="vm.filter.typeSearch == 3 ">
                        <div class="row pt-md-2">
                          <div class="col-md-6">
                            <mpf-datepicker
                              class="input-no-margin"
                              label="{label: 'Desde', required: true}"
                              ng-model="vm.filter.startDate"
                              format="'dd/MM/yyyy'"
                              name="fechaInicio">
                            </mpf-datepicker>
                          </div>
                          <div class="col-md-6">
                            <mpf-datepicker
                              class="input-no-margin"
                              label="{label: 'Hasta', required: true}"
                              ng-model="vm.filter.endDate"
                              format="'dd/MM/yyyy'"
                              name="fechaFin">
                            </mpf-datepicker>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="g-select-horz pt-xs-1">
                        <label class="g-placeholder">Destino*</label>
                        <div class="g-select-desing">
                          <mpf-select
                            class="no-label"
                            ng-model="vm.filter.destination"
                            name="destino"
                            label="{label: '', required: false}"
                            m-data-source="vm.destinations"
                            text-field="name"
                            value-field="name"
                            m-Empty-Option="{enterData:true, text: 'TODOS'}">
                          </mpf-select>
                        </div>
                      </div>
                      <div class="g-select-horz pt-xs-1">
                        <label class="g-placeholder">Estado<span ng-show="">*</span></label>
                        <div class="g-select-desing">
                          <mpf-select
                            class="no-label"
                            ng-model="vm.filter.state"
                            name="estado"
                            label="{label: '', required: false}"
                            m-data-source="vm.states"
                            text-field="description"
                            value-field="value"
                            m-Empty-Option="{enterData:true, text: 'TODOS'}">
                          </mpf-select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 pr-xs-1 mb-xs-1 no-mb-md">
                    <button type="submit" class="g-btn g-btn-verde second-design block">
                      Buscar
                    </button>
                  </div>
                  <div class="col-md-6 pl-xs-1">
                    <button type="button" class="g-btn g-btn-white second-design block" ng-click="vm.initFilter()">
                      Limpiar
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <!-- Fin: Filter -->
        <!-- Inicio: Resultado -->
        <div class="col-md-9">
          <!-- Mensaje de realiza una búsqueda -->
          <div class="col-md-12 text-center g-box-noresult" ng-if="!vm.emissions && vm.firstLoad">
            <div class="row">
              <div class="col-md-12 g-box-noresult-ico gCBlue2">
                <span class="ico-mapfre_303_informacion"></span>
              </div>
              <div class="col-md-12 g-box-noresult-text">
                Realiza una búsqueda para obtener resultados.
              </div>
            </div>
          </div>
          <!-- FIn -->
          <!-- Mensaje de error si no hay resultados -->
          <div class="col-md-12 text-center g-box-noresult" ng-if="vm.emissions.data.length == 0">
            <div class="row">
              <div class="col-md-12 g-box-noresult-ico gCRed1">
                <span class="ico-mapfre_302_error"></span>
              </div>
              <div class="col-md-12 g-box-noresult-text">No hay resultados para los filtros escogidos.<br>Intente nuevamente.</div>
            </div>
          </div>
          <!-- FIn -->
          <div class="row" ng-if="vm.emissions.data.length > 0">
            <div class="col-md-12 gH4 gCGray3 g-text-right-md mb-xs-1">
              Total cotizaciones: {{vm.emissions.data.length}}
            </div>
          </div>
          <div class="clearfix  g-list-md g-box gBgcGray5 pt-xs-1 mb-xs-1 g-row-fz12" ng-repeat="item in vm.emissions.data" ng-if="vm.emissions.data.length > 0">
            <div class="col-md-12 g-col-md middle">
              <div class="row">
                <div class="col-sm-3 clearfix cnt-item add-border-left">
                  <div class="item-label">
                    Póliza
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.policyNumber}}
                  </div>
                  <span
                    class="g-box-label gBgcGray3 text-center"
                    ng-class="{
                      'gBgcRed4' : item.stateCode == 'C',
                      'gBgcYellow1' : item.stateCode == 'E',
                      'gBgcGray3' : item.stateCode == 'A',
                      'gBgcGreen2' :  item.stateCode == 'V',
                    }">
                    {{item.stateName}}
                  </span>
                </div>
                <div class="col-sm-3 clearfix cnt-item add-border-left">
                  <div class="item-label">
                    Fecha emisión:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.emissionDate}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item">
                  <div class="item-label">
                    Inicio de vigencia:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.departureDate}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item">
                  <button ng-click="vm.getPDF(item.technicalControl, item.policyNumber)" type="button" class="g-btn g-btn-white block">DESCARGAR</button>

                  <!-- MSAAVEDRA 20210804 -->
                  <a ng-if="item.policyNumber" 
                    ng-click="vm.enviarPolizaMail(item)"
                    class="g-btn g-btn-verde block second-design add-ico ng-scope" style="margin-top: 2px;">ENVIAR</a>
                  <!-- FIN MSAAVEDRA -->
                  
                </div>
              </div>
              <div class="row mt-xs-1">
                <div class="col-sm-3 clearfix cnt-item add-border-left">
                  <div class="item-label">
                    Producto
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.planName}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item add-border-left">
                  <div class="item-label">
                    Fin de vigencia:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.arrivalDate}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item">
                  <div class="item-label">
                    Contratante:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.name}} {{item.firstLastName}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item">
                  <div class="item-label">
                    Siniestro:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.isSinister == 0 ? 'NO' : 'SI' }}
                  </div>
                </div>
              </div>
              <div class="row mt-xs-1">
                <div class="col-sm-3 clearfix cnt-item add-border-left">
                  <div class="item-label">
                    Moneda:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.currencyCode == '2' ? 'DOLAR' : 'SOLES'}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item add-border-left">
                  <div class="item-label">
                    Código de agente:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.agentCode}}
                  </div>
                </div>
                <div class="col-sm-3 clearfix cnt-item">
                  <div class="item-label">
                    PTO:
                  </div>
                  <div class="item-dato g-text-uppercase">
                    {{item.totalBonus | currency:''}}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Inicio: pagination -->
          <div class="row" ng-if="vm.emissions.totalPages > 1">
            <div class="col-md-12">
              <ul
                uib-pagination
                class="g-pagination"
                ng-model="vm.filter.pageNum"
                ng-change="vm.getEmission(vm.filter.pageNum)"
                items-per-page="vm.filter.pageSize"
                total-items="vm.emissions.totalRows"
                boundary-link-numbers="true">
              </ul>
            </div>
          </div>
          <!-- Fin: pagination -->
        </div>
      </div>
    </div>
  </div>
  <!-- Fin: Col Filter -->
</section>
